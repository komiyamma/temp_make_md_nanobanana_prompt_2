# ç¬¬13ç« ï¼šæ‰‹å‹•DIï¼ˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ï¼‰ã‚’ã‚„ã£ã¦ã¿ã‚ˆã†ğŸ’‰ğŸ§±âœ¨

ã“ã®ç« ã¯ã€ŒDIPã‚’â€œã¡ã‚ƒã‚“ã¨å‹•ãå½¢â€ã«ã™ã‚‹ã€ãŸã‚ã®è¶…å®šç•ªã‚¹ã‚­ãƒ«å›ã ã‚ˆã€œï¼ğŸ˜Š
ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* ã‚¯ãƒ©ã‚¹ã®ä¸­ã§ä¾å­˜å…ˆã‚’ **new ã—ãªã„** ğŸš«ğŸ†•
* ä»£ã‚ã‚Šã«ã€å¤–ã‹ã‚‰ **ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ¸¡ã™** ğŸ§ºğŸ’–
* ã€Œçµ„ã¿ç«‹ã¦æ‹…å½“ï¼ˆnewã™ã‚‹å ´æ‰€ï¼‰ã€ã‚’ **å…¥å£ï¼ˆentryï¼‰ã«å¯„ã›ã‚‹** ğŸšªğŸ§©

---

## 1) ã¾ãšâ€œä½•ãŒã‚¤ãƒ¤ãªã®ï¼Ÿâ€ã‚’1åˆ†ã§ğŸ’¥ğŸ˜µ

![grip_of_new](./picture/dip_ts_study_013_grip_of_new.png)


## âŒ æ‚ªã„ä¾‹ï¼šã‚¯ãƒ©ã‚¹ã®ä¸­ã§ new ã—ã¡ã‚ƒã†

* ä¸Šä½ï¼ˆæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ï¼‰ãŒã€ä¸‹ä½ï¼ˆå¤–éƒ¨I/Oã‚„å®Ÿè£…è©³ç´°ï¼‰ã‚’ã‚¬ãƒƒãƒãƒªæ¡ã‚‹ğŸ¤ğŸ’¦
* æ”¯æ‰•ã„æ–¹æ³•ã‚„ä¿å­˜å…ˆã‚’å¤‰ãˆã‚‹ã¨ã€ä¸Šä½ã‚³ãƒ¼ãƒ‰ã¾ã§å·»ãæ·»ãˆã§ä¿®æ­£ãŒé£›ã¶ğŸŒ€
* ãƒ†ã‚¹ãƒˆã§å·®ã—æ›¿ãˆãŒã§ããªãã¦è©°ã‚€ğŸ™ˆğŸ§ª

ã“ã®ã€Œã‚¬ãƒƒãƒãƒªæ¡ã£ã¦ã‚‹çŠ¶æ…‹ã€ã‚’ã»ã©ãã®ãŒã€æ‰‹å‹•DIï¼ˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ï¼‰ã ã‚ˆã€œï¼ğŸ’‰âœ¨

---

## 2) ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ã£ã¦ãªã«ï¼ŸğŸ—ï¸ğŸ’•

![carpenter_tools](./picture/dip_ts_study_013_carpenter_tools.png)


**ä¾å­˜ã™ã‚‹é“å…·ï¼ˆä¸‹ä½ï¼‰ã‚’ã€å¤–ã‹ã‚‰å—ã‘å–ã‚‹** ã ã‘ï¼ã‚·ãƒ³ãƒ—ãƒ«ï¼ğŸ˜Š

* âœ… ã‚¯ãƒ©ã‚¹ã¯ã€Œè‡ªåˆ†ã§é“å…·ã‚’è²·ã‚ãªã„ã€
* âœ… ã€Œé“å…·ã¯å…¥å£ã§ç”¨æ„ã—ã¦æ¸¡ã™ã€
* âœ… ã ã‹ã‚‰ã€Œé“å…·ã®å·®ã—æ›¿ãˆã€ãŒä¸€ç¬ã§ã§ãã‚‹ğŸ”âœ¨

---

## 3) ã‚µãƒ³ãƒ—ãƒ«é¡Œæï¼šæ³¨æ–‡å‡¦ç†ã‚’ã¡ã‚‡ã„å®Ÿå‹™ã£ã½ãğŸ“¦ğŸ’³

ã“ã“ã§ã¯ã€æ³¨æ–‡ã‚’ä½œã£ã¦æ”¯æ‰•ã„ã—ã¦ä¿å­˜ã™ã‚‹æµã‚Œã«ã™ã‚‹ã‚ˆğŸ˜Š

* ä¸Šä½ï¼šOrderServiceï¼ˆæ¥­å‹™ãƒ«ãƒ¼ãƒ«ï¼‰ğŸ§ âœ¨
* ä¸‹ä½ï¼šPaymentGatewayï¼ˆå¤–éƒ¨æ±ºæ¸ˆï¼‰ğŸ’³ğŸŒ
* ä¸‹ä½ï¼šOrderRepositoryï¼ˆä¿å­˜å…ˆï¼‰ğŸ—„ï¸
* ä¸‹ä½ï¼šClockï¼ˆæ™‚é–“ï¼‰â°

---

## 4) âŒ DIP/DIãªã—ï¼šOrderService ãŒ new ã—ã¦ã‚‹ç‰ˆğŸ”¥

![bad_example_visual](./picture/dip_ts_study_013_bad_example_visual.png)


```ts
// ä¸‹ä½ã®è©³ç´°ï¼ˆä¾‹ï¼‰
class StripePaymentGateway {
  async charge(amountYen: number): Promise<string> {
    // å¤–éƒ¨APIã«é€šä¿¡ã™ã‚‹æƒ³å®šâ€¦ğŸŒ
    return "pay_123";
  }
}

class SqlOrderRepository {
  async save(order: { id: string; paidAt: Date; paymentId: string }) {
    // DBã«ä¿å­˜ã™ã‚‹æƒ³å®šâ€¦ğŸ—„ï¸
  }
}

// ä¸Šä½ï¼ˆæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
class OrderService {
  async placeOrder(amountYen: number) {
    // ğŸ‘‡ ã“ã“ãŒå•é¡Œï¼ ä¸Šä½ãŒä¸‹ä½ã‚’ç›´newã—ã¦æ¡ã£ã¦ã‚‹ğŸ˜µ
    const payment = new StripePaymentGateway();
    const repo = new SqlOrderRepository();

    const paymentId = await payment.charge(amountYen);

    const order = {
      id: crypto.randomUUID(),
      paidAt: new Date(),
      paymentId,
    };

    await repo.save(order);
    return order.id;
  }
}
```

## ä½•ãŒå›°ã‚‹ï¼ŸğŸ˜¢

* æ±ºæ¸ˆã‚’ PayPay ã«å¤‰ãˆãŸã„ â†’ OrderService ã‚’ç·¨é›†ã™ã‚‹ç¾½ç›®ğŸ˜µâ€ğŸ’«
* ãƒ†ã‚¹ãƒˆã§ã€Œé€šä¿¡ã—ãªã„æ±ºæ¸ˆã€ã‚’ä½¿ã„ãŸã„ â†’ ã§ããªã„ğŸ™ˆ
* æ™‚é–“ï¼ˆnew Dateï¼‰ã‚‚å›ºå®šã§ããªã„ â†’ ãƒ†ã‚¹ãƒˆãŒåœ°ç„â°ğŸ§ª

---

## 6) âœ… æœ¬é¡Œï¼šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ã§ã€Œnewã‚’è¿½ã„å‡ºã™ã€ğŸ’‰ğŸšª

![](./picture/dip_ts_study_013_constructor_injection.png)


TypeScriptã¯ã€Œå½¢ï¼ˆæ§‹é€ ï¼‰ã€ã§åˆã‚ã›ã‚‰ã‚Œã‚‹ã®ãŒå¼·ã¿ğŸ’ª

```mermaid
classDiagram
    class OrderService {
        -payment: PaymentGateway
        -repo: OrderRepository
        +placeOrder()
    }
    class PaymentGateway {
        <<interface>>
        +pay()
    }
    class StripePayment {
        +pay()
    }
    
    OrderService o-- PaymentGateway : ä¿æœ‰ (ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§å—ã‘å–ã‚‹)
    StripePayment ..|> PaymentGateway : å®Ÿè£…
    
    note for OrderService "ã€Œnewã€ã¯ã—ãªã„ï¼\nå—ã‘å–ã£ãŸã‚‚ã®ã‚’ä½¿ã†ã ã‘ğŸ¤²"
```

ã¤ã¾ã‚Š **interfaceï¼ˆå¥‘ç´„ï¼‰ã•ãˆåˆãˆã°å·®ã—æ›¿ãˆOK**ï¼

```ts
// â‘  æ±ºæ¸ˆã®å¥‘ç´„ï¼ˆãƒãƒ¼ãƒˆï¼‰
export interface PaymentGateway {
  charge(amountYen: number): Promise<{ ok: true; paymentId: string } | { ok: false; reason: string }>;
}

// â‘¡ ä¿å­˜ã®å¥‘ç´„ï¼ˆãƒãƒ¼ãƒˆï¼‰
export interface OrderRepository {
  save(order: { id: string; paidAt: Date; paymentId: string }): Promise<void>;
}

// â‘¢ æ™‚é–“ã®å¥‘ç´„ï¼ˆãƒãƒ¼ãƒˆï¼‰
export interface Clock {
  now(): Date;
}
```

---

## 6) âœ… æœ¬é¡Œï¼šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ã§ã€Œnewã‚’è¿½ã„å‡ºã™ã€ğŸ’‰ğŸšª

```ts
export class OrderService {
  // ğŸ‘‡ ä¾å­˜ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§å—ã‘å–ã‚‹ï¼ˆã“ã‚ŒãŒã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ï¼‰
  constructor(
    private readonly payment: PaymentGateway,
    private readonly repo: OrderRepository,
    private readonly clock: Clock,
  ) {}

  async placeOrder(amountYen: number) {
    const charged = await this.payment.charge(amountYen);
    if (!charged.ok) {
      throw new Error(`æ”¯æ‰•ã„å¤±æ•—: ${charged.reason}`);
    }

    const order = {
      id: crypto.randomUUID(),
      paidAt: this.clock.now(),
      paymentId: charged.paymentId,
    };

    await this.repo.save(order);
    return order.id;
  }
}
```

## ã“ã“ãŒæœ€é«˜ãƒã‚¤ãƒ³ãƒˆğŸ‰âœ¨

* OrderService ã¯ã€Œæ±ºæ¸ˆãŒStripeã‹ã©ã†ã‹ã€çŸ¥ã‚‰ãªã„ğŸ™ˆ
* OrderService ã¯ã€ŒDBãŒSQLã‹ã©ã†ã‹ã€çŸ¥ã‚‰ãªã„ğŸ™ˆ
* OrderService ã¯ã€Œæ™‚é–“ãŒæœ¬ç‰©ã‹å›ºå®šã‹ã€çŸ¥ã‚‰ãªã„ğŸ™ˆ
  â†’ ã ã‹ã‚‰å·®ã—æ›¿ãˆãƒ»ãƒ†ã‚¹ãƒˆãŒæœ€å¼·ã«ãªã‚‹ğŸ’ªğŸ§ª

---

## 7) å®Ÿè£…ï¼ˆä¸‹ä½ï¼‰ã¯â€œå¥‘ç´„ã‚’æº€ãŸã™ã ã‘â€ã§OKğŸ”§ğŸŒğŸ—„ï¸

```ts
export class StripePaymentGateway implements PaymentGateway {
  async charge(amountYen: number) {
    // ã“ã“ã§å¤–éƒ¨æ±ºæ¸ˆAPIã«é€šä¿¡ã™ã‚‹æƒ³å®š
    return { ok: true as const, paymentId: "pay_123" };
  }
}

export class SqlOrderRepository implements OrderRepository {
  async save(order: { id: string; paidAt: Date; paymentId: string }) {
    // ã“ã“ã§DBä¿å­˜ã™ã‚‹æƒ³å®š
  }
}

export class SystemClock implements Clock {
  now() {
    return new Date();
  }
}
```

---

## 8) â€œçµ„ã¿ç«‹ã¦å ´æ‰€â€ã¯ã©ã“ãŒè‰¯ã„ï¼ŸğŸ‘‰ å…¥å£ï¼ˆentryï¼‰ã ã‚ˆğŸšªâœ¨

![entry_assembler](./picture/dip_ts_study_013_entry_assembler.png)


ã“ã“ãŒè¶…å¤§äº‹ï¼
**new ã—ã¦ã„ã„ã®ã¯ã€åŸºæœ¬çš„ã«å…¥å£ã ã‘**ï¼ˆçµ„ã¿ç«‹ã¦æ‹…å½“ï¼‰ğŸ‘

```ts
import { OrderService } from "./OrderService";
import { StripePaymentGateway } from "./StripePaymentGateway";
import { SqlOrderRepository } from "./SqlOrderRepository";
import { SystemClock } from "./SystemClock";

async function main() {
  // ğŸ‘‡ å…¥å£ã§çµ„ã¿ç«‹ã¦ï¼ˆã“ã“ã¯newã—ã¦OKï¼ï¼‰
  const payment = new StripePaymentGateway();
  const repo = new SqlOrderRepository();
  const clock = new SystemClock();

  const service = new OrderService(payment, repo, clock);

  const orderId = await service.placeOrder(1200);
  console.log("æ³¨æ–‡å®Œäº†:", orderId);
}

main().catch(console.error);
```

ã“ã®ã€Œå…¥å£ã§çµ„ã¿ç«‹ã¦ã‚‹å ´æ‰€ã€ã‚’ã‚ˆã **Composition Rootï¼ˆã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒˆï¼‰** ã£ã¦å‘¼ã¶ã‚ˆğŸŒ±âœ¨
ï¼ˆè¨€è‘‰ã¯é›£ã—ã„ã‘ã©ã€ã‚„ã£ã¦ã‚‹ã“ã¨ã¯â€œçµ„ã¿ç«‹ã¦ä¿‚â€ã­ğŸ˜Šï¼‰

---

## 9) ã‚ˆãã‚ã‚‹ãƒŸã‚¹ã‚ã‚‹ã‚ã‚‹ğŸ˜µâ€ğŸ’«âš ï¸

## ãƒŸã‚¹â‘ ï¼šé€”ä¸­ã§ã¾ãŸ new ã—ã¡ã‚ƒã†

* ã€Œã¡ã‚‡ã£ã¨ã ã‘ãªã‚‰â€¦ã€ãŒå¢—æ®–ã™ã‚‹ã‚„ã¤ğŸ¥²
* è¿·ã£ãŸã‚‰ã€Œãã‚Œã¯å…¥å£ã§ä½œã‚Œãªã„ï¼Ÿã€ã£ã¦è€ƒãˆã‚‹ã®ãŒã‚³ãƒ„ğŸ’¡

## ãƒŸã‚¹â‘¡ï¼šä¾å­˜ãŒå¢—ãˆã™ãã¦ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒé•·ã„

![long_constructor](./picture/dip_ts_study_013_long_constructor.png)


* ã‚ã‚‹ã‚ã‚‹ï¼ã§ã‚‚ç„¦ã‚‰ãªã„ã§OKğŸ˜Š
* å¯¾ç­–ã¯æ¬¡ã®ã©ã‚Œã‹ğŸ‘‡

  * ä¾å­˜ãŒå¤šã„åŸå› ï¼ˆè²¬å‹™éå¤šï¼‰ã‚’ç–‘ã†ğŸ§ 
  * è¿‘ã„ã‚‚ã®ã‚’ã¾ã¨ã‚ãŸâ€œå°ã•ãªä¾å­˜ã®å¡Šâ€ã‚’ä½œã‚‹ğŸ§º
  * ã€Œè¨­å®šå€¤ã€ã¯ ConfigProvider çš„ã«ã¾ã¨ã‚ã‚‹âš™ï¸

---

## 10) TypeScript/å‘¨è¾ºã®â€œã„ã¾â€ãƒ¡ãƒ¢ï¼ˆ2026/01æ™‚ç‚¹ï¼‰ğŸ—“ï¸âœ¨

* TypeScriptã®å®‰å®šç‰ˆã¯ 5.8.3 ãŒç¢ºèªã§ãã¦ã€5.9ã¯RC/ãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹æƒ…å ±ã‚‚å‡ºã¦ã‚‹ã‚ˆğŸ“Œ ([GitHub][1])
* Node.jsã¯ v24 ãŒActive LTSã¨ã—ã¦æ¡ˆå†…ã•ã‚Œã¦ã‚‹ï¼ˆé–‹ç™ºãƒ»é‹ç”¨ã§é¸ã°ã‚Œã‚„ã™ã„ãƒ©ã‚¤ãƒ³ï¼‰ğŸŸ¢ ([Node.js][2])
* VS Codeã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚‚ 2026å¹´1æœˆã®æ›´æ–°ãŒå‡ºã¦ã‚‹ã‚ˆğŸ“âœ¨ ([Visual Studio Code][3])

ï¼ˆã“ã®ç« ã®å†…å®¹è‡ªä½“ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰ã‚ã£ã¦ã‚‚å¼·ã„åŸºæœ¬ã ã‚ˆã€œğŸ’ªğŸ˜Šï¼‰

---

## ç« æœ«ã‚»ãƒƒãƒˆğŸ€ğŸ“Œ

## ã¾ã¨ã‚ï¼ˆ3è¡Œï¼‰ğŸ§¾âœ¨

* ã‚¯ãƒ©ã‚¹ã®ä¸­ã§ new ã™ã‚‹ã¨ã€ä¾å­˜ãŒå›ºå®šã•ã‚Œã¦å·®ã—æ›¿ãˆã§ããªããªã‚‹ğŸ˜µ
* ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ã¯ã€Œå¤–ã‹ã‚‰ä¾å­˜ã‚’æ¸¡ã™ã€ã ã‘ã®æœ€å¼·ãƒ†ã‚¯ğŸ’‰
* new ã¯å…¥å£ï¼ˆentryï¼‰ã«å¯„ã›ã¦ã€æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚­ãƒ¬ã‚¤ã«ä¿ã¤ğŸ’–

## ãƒŸãƒ‹æ¼”ç¿’ï¼ˆ1ã€œ2å•ï¼‰âœï¸ğŸ§¸

1. ã•ã£ãã®ã€ŒDIP/DIãªã—ã‚³ãƒ¼ãƒ‰ã€ã‚’ã€PaymentGateway / OrderRepository / Clock ã‚’ä½¿ã†å½¢ã«æ›¸ãæ›ãˆã¦ã¿ã¦ã­ğŸ˜Š
2. å…¥å£ï¼ˆmainï¼‰ã§ â€œStripeâ†’FakePaymentâ€ ã«å·®ã—æ›¿ãˆã¦ã‚‚ OrderService ã‚’ä¸€åˆ‡å¤‰æ›´ã—ãªã„ã§å‹•ãçŠ¶æ…‹ã«ã—ã¦ã¿ã¦ã­ğŸ”âœ¨

## AIã«èãç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ¤–ğŸ’¬

* ã€Œã“ã®TypeScriptã‚³ãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹å†…ã§newã—ã¦ã„ã‚‹ä¾å­˜ã‚’ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿æ³¨å…¥ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã—ã¦ã€‚å…¥å£ã§çµ„ã¿ç«‹ã¦ã‚‹mainã‚‚ä¸€ç·’ã«ææ¡ˆã—ã¦ã€
* ã€Œä¾å­˜ãŒå¢—ãˆã¦ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒé•·ã„ã€‚è²¬å‹™åˆ†å‰²ã®è¦³ç‚¹ã§ã€ã©ã“ãŒâ€œã‚„ã‚Šã™ãâ€ã‹æŒ‡æ‘˜ã—ã¦ã€æ”¹å–„æ¡ˆã‚’2ãƒ‘ã‚¿ãƒ¼ãƒ³å‡ºã—ã¦ã€
* ã€ŒFakeå®Ÿè£…ï¼ˆé€šä¿¡ã—ãªã„PaymentGatewayï¼‰ã‚’ä½œã£ã¦ã€OrderServiceã®ãƒ†ã‚¹ãƒˆãŒã—ã‚„ã™ã„å½¢ã«ã—ã¦ã€‚å·®ã—æ›¿ãˆã®ä¾‹ã‚‚è¦‹ã›ã¦ã€

---

æ¬¡ã®ç¬¬14ç« ï¼ˆHTTP/å¤–éƒ¨APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã«è¡Œãã¨ã€ã“ã®â€œå…¥å£ã§çµ„ã¿ç«‹ã¦ã‚‹â€ãŒã•ã‚‰ã«æ°—æŒã¡ã‚ˆãåŠ¹ã„ã¦ãã‚‹ã‚ˆã€œğŸŒğŸ“¡âœ¨

[1]: https://github.com/microsoft/typescript/releases?utm_source=chatgpt.com "Releases Â· microsoft/TypeScript"
[2]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
[3]: https://code.visualstudio.com/updates?utm_source=chatgpt.com "December 2025 (version 1.108)"
